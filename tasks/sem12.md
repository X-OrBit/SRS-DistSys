# Семинар 12

**Статья:** [When Amnesia Strikes: Understanding and Reproducing Data Loss Bugs with Fault Injection](https://dl.acm.org/doi/pdf/10.1145/3477132.3483540) (VLDB 2024)

## Реферат

### Цитирование

Выбранная статья: [Can Applications Recover from fsync Failures?](https://www.usenix.org/system/files/atc20-rebello.pdf)

В основной статье данная работа используется для подкрепление утверждений о функционировании storage stack. Авторы ссылается на нее, чтобы описать роль fsync и оптимизаций I/O на уровне ОС, которые создают предпосылки для изучаемых багов в статье.

### Предметная область и постановка задачи
Статья относится к сфере надежности данных, отказоустойчивости систем хранения данных. Она исследует проблему того, как файловые системы и приложения ведут себя при ошибках fsync, который по сути призван гарантировать запись на диск.
Задача делиться на два основных вопроса: какова семантика ошибок fsync в популярных FS у Linux; способны ли современные приложения для хранения данных корректно восстанавливаться после сбоев у fsync

### Мотивация и актуальность
В пример актуальности приводят баг в Postgres (https://archive.fosdem.org/2019/schedule/event/postgresql_fsync/), в котором разработчики считали, что повторный fsync после сбоя решает проблему. Но из-за того, как устроены файловые системы, они помечали данные как синхронизированные из-за чего второй fsync ничего не делал.
Проблема такова, что POSIX расплывчато описывает поведение при сбое fsync(), оставляя это за кулисами, каждая реализация файловой системы может иметь свое поведение при ошибках. В результате чего, приложения делают некорректные предположения и ломаются.

### Подход
В первую очередь исследование анализирует поведение файловой системы при точечных сбоях. Делают с помощью модуля ядра для device-mapper. Смотрят на все это под нагрузкой и анализирует состояние после искусственного сбоя fsync().
Также анализируют сами приложения. Для этого создали искусственную файловую систему CuttleFS (через FUSE). С помощью него имитируют различные поведения при сбое fsync. Так, авторы протестировали популярные системы, такие как: Postgres, LMDB, LevelDB, SQLite, Redis (смотрели на различные аномалии, потеря данных, ошибки и т.д)

### Вклад и новизна
Авторы смогли детально описать и сравнить поведение fsync при сбоях на различных файловых системах Linux. Создали CuttleFS как инструмент, который выполняет роль файловой системы для тестирования. И самое важное, показали, что современные приложения не готовы к восстановлению после сбоя fsync. И просто рестарт после ошибки не является единым решением.
