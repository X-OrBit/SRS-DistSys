# Семинар 2

**Статья:** [Rethinking Software Runtimes for Disaggregated Memory](https://rs3lab.github.io/assets/papers/2021/calciu:kona.pdf) (ASPLOS 2021)

## Реферат

### Цитирование

В исходной статье LegoOS используется как бейзлайн удаленной памяти и ОС над дезагрегированными ресурсами. По нему измеряют задержки, AMAT и другие метрики. Еще отмечается, что идеи в Kona и LegoOS не противоречат друг-другу, в частности, идеи гранулярности кеш-линии и избегания пейдж-фолтов могут быть применены в LegoOS. Ссылка: https://www.usenix.org/system/files/osdi18-shan.pdf

### Предметная область и постановка задачи
Статья посвящена ОС для аппаратных дезагрегированных ресурсов в датацентрах, где процессоры, память и хранилища физически вынесены в отдельные пули и соединены микросекундными каналами. Целью является представление этих ресурсов как обычных для приложений в том же POSIX-совместимом формате: интерфейсы взаимодействия процессов, памяти и файловой системы; безопасность и изоляцию, а также обеспечить легкое и независимое масштабирование отдельных ресурсов. Из требований можно выделить прозрачность: приложения работают в том же формате, не требуется их переписывать для работы с дезагрегированными ресурсами, низкие задержки удаленных операций, управляемость и отказоустойчивость.

### Мотивация и актуальность
Мотивация исходит из низкой утилизации ресурсов приложениями и затратного overprovisioning'а (выделения большего количества ресурсов), память/cpu часто простаивает, а масштабирование одного, обычно ведет к увеличению ресурсов другого. Дезагрегация позволяет наполнять серверы в кластерах тем ресурсом, который нужен. Однако традиционные ОС не позволяет просто добавить такие ресурсы, в основном не рассчитаны на то, что память/файлы могут где-то в удаленном месте, по сети, а варианты в виде KV-хранилищ требуют фундаментальных изменений в коде программы.

### Подход

В LegoOS состояние процесса разделено: вычисления идут на CPU-узле, страницы адресного пространства хранятся и обслуживаются на удаленных memory узлах, аналогично файлы на storage узлах. Страницы передаются по сети и кэшируются; защита на запись соблюдается, грязные страницы отдаются обратно; при изменении отображений инвалидируют записи TLB. Ресурсные пулы гибко распределяются между машинами.

### Вклад и новизна
Вклад работы - описанная архитектура ОС и его прототип, поддерживающий аппаратную дезагригацию с сохранением привычных интерфейсов. Новизна - разнесенное ядро, обеспечивающее ресурсы поверх сетевых пулов, и практическая демонстрация того, что удаленная память может обслуживаться задержками порядка ~10мкс на выборку страницы. Авторы реализуют полнофункциональные подсистемы, показывая при этом совместимость с приложениями, изоляцию и управляемое масштабирование, а также сопоставимую производительность с монолитными узлами. Бенчмарки в статье показывают значительное преимущество решения над вариантом с Linux со SWAP или идее InfiniSwap. Результаты работы стали ориентиром для последующих решений: при сохранении прозрачности неизбежны издержки, увеличивающая задержку и сетевую нагрузку при частичных модификациях страниц. Это послужило опорой для дальнейших исследований (например, Kona), стремящихся сохранить прозрачность, но уйти от страничных ограничений за счет кеш-когерентности и гранулярности отслеживания и перемещения данных.
